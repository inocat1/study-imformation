<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é«˜ä¸­åŒ–å­¸å…¨èƒ½ç‰¹è¨“</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* æ²¿ç”¨è‹±æ–‡ç‰ˆçš„ä¸»é¡Œè‰² (ç´«è‰²æ¼¸å±¤)ï¼Œä½†å¡ç‰‡å…§ä¿ç•™åŒ–å­¸ç¶  */
            --app-bg-start: #667eea;
            --app-bg-end: #764ba2;
            --primary: #0d9488; /* åŒ–å­¸ç¶  */
            --primary-light: #ccfbf1;
            --text: #1e293b;
            --gray: #64748b;
            --success: #059669;
            --error: #dc2626;
            --slot-bg: #e2e8f0;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, var(--app-bg-start) 0%, var(--app-bg-end) 100%);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.98);
            min-height: 90vh;
            border-radius: 24px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        /* --- Header --- */
        header {
            text-align: center;
            padding: 20px;
            background: #fff;
            position: sticky;
            top: 0;
            z-index: 50;
            border-bottom: 1px solid #e2e8f0;
        }
        .back-btn {
            position: absolute; left: 15px; top: 20px;
            background: #f1f5f9; border: none; padding: 6px 14px; border-radius: 20px;
            font-size: 0.9rem; color: var(--gray); font-weight: bold; cursor: pointer; text-decoration: none;
        }
        h1 { margin: 0; font-size: 1.5rem; color: #333; letter-spacing: 1px; }

        /* --- Tab åˆ‡æ› --- */
        .tab-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 15px;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }
        .tab-btn {
            padding: 10px 24px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: bold;
            color: var(--gray);
            background: #e2e8f0;
            cursor: pointer;
            transition: 0.3s;
        }
        .tab-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 10px rgba(13, 148, 136, 0.3);
        }

        /* --- å…§å®¹å€å¡Š --- */
        .view-section { display: none; padding: 20px; flex: 1; overflow-y: auto; }
        .view-section.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* --- [View 1] ç­†è¨˜æ¨¡å¼ --- */
        .note-card {
            background: #fff; border-radius: 12px; padding: 25px; margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-left: 5px solid var(--primary); border-top: 1px solid #f1f5f9;
        }
        h2 { color: #0f766e; margin-top: 0; margin-bottom: 20px; font-size: 1.3rem; border-bottom: 1px dashed #cbd5e1; padding-bottom: 10px; }
        
        table { width: 100%; border-collapse: collapse; font-size: 0.95rem; min-width: 600px; }
        .table-wrapper { overflow-x: auto; }
        th { background-color: var(--primary); color: white; padding: 12px; text-align: left; white-space: nowrap; }
        td { border-bottom: 1px solid #e2e8f0; padding: 12px; vertical-align: top; }
        tr:nth-child(even) { background-color: #f8fafc; }
        
        .formula { font-family: 'Courier New', monospace; background: #f3e8ff; padding: 2px 6px; border-radius: 4px; color: #7e22ce; font-weight: bold; }
        .highlight { color: #b45309; font-weight: bold; background: #fffbeb; padding: 0 3px; }
        
        /* æ¨™ç±¤ */
        .tag { display: inline-block; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem; color: white; margin-bottom: 5px; font-weight: bold; }
        .tag-med { background: #ef4444; } .tag-clean { background: #3b82f6; } 
        .tag-poly { background: #8b5cf6; } .tag-food { background: #10b981; } .tag-energy { background: #f59e0b; }

        /* --- [View 2] æ¸¬é©—é¸å–® --- */
        .stats-panel {
            background: var(--primary); color: white; padding: 20px; border-radius: 16px;
            margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 5px 15px rgba(13, 148, 136, 0.3);
        }
        .chapter-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding-bottom: 80px; }
        .chapter-card {
            background: #f8fafc; border: 2px solid transparent; border-radius: 12px; padding: 15px;
            cursor: pointer; transition: 0.2s; position: relative; overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); min-height: 90px; display: flex; flex-direction: column; justify-content: center;
        }
        .chapter-card.selected { border-color: var(--primary); background-color: var(--primary-light); }
        .chapter-card.selected::after {
            content: 'âœ“'; position: absolute; top: 5px; right: 5px; background: var(--primary); color: white;
            border-radius: 50%; width: 20px; height: 20px; font-size: 12px; display: flex; align-items: center; justify-content: center;
        }
        .ch-title { font-weight: bold; font-size: 1.05rem; margin-bottom: 5px; color: #333; }
        .ch-count { font-size: 0.85rem; color: var(--gray); }

        /* åº•éƒ¨æ‡¸æµ®æŒ‰éˆ• */
        .bottom-dock {
            position: absolute; bottom: 0; left: 0; width: 100%;
            background: rgba(255, 255, 255, 0.9); padding: 15px 20px;
            border-top: 1px solid #e2e8f0; backdrop-filter: blur(5px);
            z-index: 100;
        }
        .start-btn {
            width: 100%; padding: 15px; border: none; border-radius: 30px;
            font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: 0.2s;
            background: var(--primary); color: white;
            box-shadow: 0 4px 10px rgba(13, 148, 136, 0.3);
        }
        .start-btn:disabled { background: #cbd5e1; box-shadow: none; cursor: not-allowed; }
        .start-btn:active { transform: scale(0.98); }

        /* --- æ¸¬é©—é€²è¡Œä¸­ --- */
        .quiz-status { display: flex; justify-content: space-between; margin-bottom: 10px; font-weight: bold; color: var(--gray); font-size: 0.9rem; }
        .progress-bar { height: 8px; background: #e2e8f0; border-radius: 4px; margin-bottom: 25px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary); width: 0%; transition: 0.3s; }
        
        .question-box {
            min-height: 180px; display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: white; border-radius: 16px; padding: 25px; margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); text-align: center; border: 1px solid #f1f5f9;
        }
        .q-text { font-size: 1.3rem; font-weight: 800; color: #333; line-height: 1.5; }
        
        /* é¸æ“‡é¡ŒæŒ‰éˆ• */
        .options-grid { display: grid; gap: 12px; }
        .opt-btn {
            background: white; border: 2px solid #e2e8f0; padding: 18px; border-radius: 12px;
            font-size: 1rem; text-align: left; cursor: pointer; transition: 0.2s; color: var(--text);
            font-weight: 500;
        }
        .opt-btn:active { background: #f1f5f9; }
        .opt-btn.correct { background: #dcfce7; border-color: var(--success); color: #166534; font-weight: bold; }
        .opt-btn.wrong { background: #fee2e2; border-color: var(--error); color: #991b1b; }

        /* å¡«ç©ºé¡Œæ¨£å¼ */
        .drop-slot {
            display: inline-flex; min-width: 80px; height: 36px; background: var(--slot-bg);
            border-bottom: 3px solid #94a3b8; border-radius: 6px; margin: 0 5px;
            vertical-align: middle; align-items: center; justify-content: center;
            color: #64748b; font-weight: bold; padding: 0 8px; font-size: 1rem;
        }
        .drop-slot.filled { background: transparent; border: none; border-bottom: 3px solid var(--primary); color: var(--primary); }
        .drop-slot.error { color: var(--error); border-bottom-color: var(--error); }
        
        .drag-pool { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-top: 10px; }
        .drag-item {
            background: white; border: 2px solid var(--primary); color: var(--primary);
            padding: 8px 16px; border-radius: 20px; font-weight: bold; cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); font-size: 1rem;
        }

        /* è§£æèˆ‡å½ˆçª— */
        .feedback-box {
            display: none; background: #f0fdfa; padding: 20px; border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05); margin-top: 20px; text-align: left;
            border: 1px solid var(--primary); animation: slideUp 0.3s;
        }
        
        .modal-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5);
            display: none; justify-content: center; align-items: center; z-index: 100; backdrop-filter: blur(3px);
        }
        .modal {
            background: white; padding: 30px; border-radius: 20px; width: 85%; max-width: 350px;
            text-align: center; box-shadow: 0 20px 40px rgba(0,0,0,0.2); animation: popIn 0.3s;
        }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .num-input {
            font-size: 2rem; padding: 10px; width: 100px; text-align: center;
            border: 2px solid #cbd5e1; border-radius: 12px; margin: 20px 0; color: var(--primary); font-weight: bold;
        }
        .modal-btns { display: flex; gap: 12px; margin-top: 20px; }

        /* çµæœé  */
        .result-box { text-align: center; background: white; padding: 40px; border-radius: 20px; margin-bottom: 20px; }
        .final-score { font-size: 4.5rem; font-weight: 800; color: var(--primary); line-height: 1; margin-bottom: 10px; }
        .mistake-card {
            background: white; padding: 15px; border-radius: 10px; border-left: 4px solid var(--error);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 10px; text-align: left;
        }

        /* SVG */
        .atom-c { fill: #333; font-weight:bold; font-family: Arial; font-size: 24px; text-anchor: middle; dominant-baseline: middle;}
        .atom-o { fill: #ef4444; font-weight:bold; font-family: Arial; font-size: 24px; text-anchor: middle; dominant-baseline: middle;}
        .atom-n { fill: #3b82f6; font-weight:bold; font-family: Arial; font-size: 24px; text-anchor: middle; dominant-baseline: middle;}
        .atom-h { fill: #666; font-weight:normal; font-family: Arial; font-size: 18px; text-anchor: middle; dominant-baseline: middle;}
        .bond { stroke: #333; stroke-width: 3; stroke-linecap: round; }
    </style>
</head>
<body>

<div class="container">
    
    <header>
        <a href="../index.html" class="back-btn">â† ç¸½éƒ¨</a>
        <h1>æœ‰æ©ŸåŒ–å­¸å…¨èƒ½ç‰¹è¨“</h1>
    </header>

    <!-- åˆ†é æŒ‰éˆ• -->
    <div class="tab-container">
        <button class="tab-btn active" onclick="switchView('note')">ğŸ“– ç­†è¨˜æ¨¡å¼</button>
        <button class="tab-btn" onclick="switchView('quiz')">ğŸ“ æ¸¬é©—å°ˆå€</button>
    </div>

    <!-- ==================== View 1: ç­†è¨˜æ¨¡å¼ ==================== -->
    <div id="view-note" class="view-section active">
        <!-- 1. åå¤§å®˜èƒ½åŸº -->
        <div class="note-card">
            <h2>ä¸€ã€æœ‰æ©Ÿå®˜èƒ½åŸºç¸½è¡¨</h2>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>å®¶æ—</th><th>å®˜èƒ½åŸº</th><th>é€šå¼</th><th>ä»£è¡¨åŒ–åˆç‰©</th><th>è€ƒè©¦è¨˜æ†¶é»</th></tr></thead>
                    <tbody>
                        <tr><td><strong>1. é†‡é¡</strong></td><td>-OH</td><td>R-OH</td><td><span class="formula">C<sub>2</sub>H<sub>5</sub>OH</span></td><td>æ˜“æº¶æ–¼æ°´ã€ä¸­æ€§ã€‚</td></tr>
                        <tr><td><strong>2. é†šé¡</strong></td><td>-O-</td><td>R-O-R'</td><td><span class="formula">CH<sub>3</sub>OCH<sub>3</sub></span></td><td>é†‡çš„åŒåˆ†ç•°æ§‹ç‰©ã€‚</td></tr>
                        <tr><td><strong>3. é†›é¡</strong></td><td>-CHO</td><td>R-CHO</td><td><span class="formula">HCHO</span></td><td><span class="highlight">æœ‰é‚„åŸåŠ›</span> (éŠ€é¡)ã€‚</td></tr>
                        <tr><td><strong>4. é…®é¡</strong></td><td>-CO-</td><td>R-CO-R'</td><td><span class="formula">CH<sub>3</sub>COCH<sub>3</sub></span></td><td>ç„¡é‚„åŸåŠ›ï¼Œæº¶åŠ‘ã€‚</td></tr>
                        <tr><td><strong>5. ç¾§é…¸</strong></td><td>-COOH</td><td>R-COOH</td><td><span class="formula">CH<sub>3</sub>COOH</span></td><td><span class="highlight">å¼±é…¸æ€§</span>ã€‚</td></tr>
                        <tr><td><strong>6. é…¯é¡</strong></td><td>-COO-</td><td>R-COO-R'</td><td>ä¹™é…¸ä¹™é…¯</td><td><span class="highlight">æ°´æœé¦™</span>ï¼Œé›£æº¶ã€‚</td></tr>
                        <tr><td><strong>7. èƒºé¡</strong></td><td>-NH<sub>2</sub></td><td>R-NH<sub>2</sub></td><td>è‹¯èƒº</td><td><span class="highlight">å¼±é¹¼æ€§</span>ï¼Œé­šè…¥ã€‚</td></tr>
                        <tr><td><strong>8. é†¯èƒº</strong></td><td>-CONH<sub>2</sub></td><td>R-CONH<sub>2</sub></td><td>ä¹™é†¯èƒº</td><td>ä¸­æ€§ï¼Œè‚½éµã€‚</td></tr>
                        <tr><td><strong>9. é…šé¡</strong></td><td>Ar-OH</td><td>C<sub>6</sub>H<sub>5</sub>OH</td><td>è‹¯é…š</td><td><span class="highlight">å¼±é…¸æ€§</span>ï¼Œæ°¯åŒ–éµç´«è‰²ã€‚</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 2. ç”Ÿæ´»åŒ–å­¸ -->
        <div class="note-card">
            <h2>äºŒã€ç”Ÿæ´»åŒ–å­¸ vs. çµæ§‹</h2>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>åˆ†é¡</th><th>åç¨±</th><th>çµæ§‹ç‰¹å¾µ</th><th>åŸç†èˆ‡è€ƒé»</th></tr></thead>
                    <tbody>
                        <tr><td><span class="tag tag-med">é†«è—¥</span></td><td><strong>é˜¿æ–¯åŒ¹éˆ</strong></td><td>ç¾§åŸº+é…¯åŸº</td><td>æ°´æ¥Šé…¸+ä¹™é…é…¯åŒ–ã€‚<span class="highlight">å‚·èƒƒ</span>ã€‚</td></tr>
                        <tr><td><span class="tag tag-clean">æ¸…æ½”</span></td><td><strong>è‚¥çš‚</strong></td><td>ç¾§é…¸é¹½</td><td>æ²¹è„‚çš‚åŒ–ã€‚<span class="highlight">æ€•ç¡¬æ°´</span>ã€‚</td></tr>
                        <tr><td><span class="tag tag-poly">èšåˆç‰©</span></td><td><strong>PET</strong></td><td>é…¯åŸº</td><td><span class="highlight">ç¸®åˆèšåˆ</span>ï¼Œå¯¶ç‰¹ç“¶ã€‚</td></tr>
                        <tr><td><span class="tag tag-poly">èšåˆç‰©</span></td><td><strong>è€ç¶¸</strong></td><td>é†¯èƒºåŸº</td><td><span class="highlight">ç¸®åˆèšåˆ</span>ï¼Œå«æ°®ã€‚</td></tr>
                        <tr><td><span class="tag tag-food">é£Ÿå“</span></td><td><strong>è‘¡è„ç³–</strong></td><td>å¤šç¾¥åŸºé†›</td><td>æœ‰é†›åŸºæ•…æœ‰<span class="highlight">é‚„åŸåŠ›</span>ã€‚</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ==================== View 2: æ¸¬é©—å°ˆå€ ==================== -->
    <div id="view-quiz" class="view-section">
        
        <!-- 1. æ¸¬é©—é¸å–® -->
        <div id="quiz-menu">
            <div class="stats-panel">
                <div style="font-size:0.9rem;">å·²é¸ <span id="selected-count" style="font-weight:bold; color:#ccfbf1; font-size:1.2rem;">0</span> å€‹å–®å…ƒ</div>
                <div style="font-size:0.9rem;">å…± <span id="total-selected-items" style="font-weight:bold; font-size:1.2rem;">0</span> é¡Œ</div>
            </div>

            <div class="chapter-grid" id="chapter-list">
                <!-- JS ç”Ÿæˆç« ç¯€ -->
            </div>

            <div class="bottom-dock">
                <button class="start-btn" id="btn-start-quiz" onclick="prepareQuiz()" disabled>ğŸ“ è¨­å®šé¡Œæ•¸ä¸¦é–‹å§‹</button>
            </div>
        </div>

        <!-- 2. æ¸¬é©—é€²è¡Œä¸­ -->
        <div id="quiz-play" style="display:none;">
            <div class="quiz-status">
                <span>é¡Œç›® <span id="q-curr">1</span> / <span id="q-total">10</span></span>
                <span>åˆ†æ•¸: <span id="score">0</span></span>
            </div>
            <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>

            <!-- é¡Œç›®å€å¡Š -->
            <div id="question-area"></div>

            <!-- é¸é …å€å¡Š (æœƒè®Šå‹•) -->
            <div id="answer-area"></div>

            <!-- è§£æå€å¡Š -->
            <div id="feedback" class="feedback-box">
                <div id="feedback-text" style="margin-bottom:15px; font-size:1rem; line-height:1.5;"></div>
                <button class="tab-btn active" style="width:100%" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ â”</button>
            </div>

            <div style="text-align:center; margin-top:30px;">
                <button style="background:none; border:none; color:#64748b; font-weight:bold; cursor:pointer;" onclick="switchView('quiz')">
                    é€€å‡ºæ¸¬é©—
                </button>
            </div>
        </div>

        <!-- 3. çµæœé  -->
        <div id="quiz-result" style="display:none;">
            <div class="result-box">
                <div class="final-score" id="final-score">100</div>
                <div class="final-label">æ¸¬é©—å¾—åˆ†</div>
            </div>

            <button class="tab-btn active" onclick="retryQuiz()" style="width:100%; margin-bottom:15px;">å†æ¸¬ä¸€æ¬¡</button>
            <button class="tab-btn" onclick="switchView('quiz')" style="width:100%;">å›æ¸¬é©—é¸å–®</button>

            <div id="mistake-section" style="display:none; margin-top:30px;">
                <h3 style="color:var(--error); text-align:center; margin-bottom:15px;">âš ï¸ éœ€åŠ å¼·çš„è§€å¿µ</h3>
                <div id="mistake-list" class="mistake-list"></div>
            </div>
        </div>
    </div>

    <!-- å½ˆçª—ï¼šé¡Œæ•¸è¨­å®š -->
    <div id="quiz-settings-modal" class="modal-overlay">
        <div class="modal">
            <h3>è¨­å®šæ¸¬é©—é¡Œæ•¸</h3>
            <p style="color:#64748b; margin-bottom:0;">ç¯„åœç¸½é¡Œæ•¸ï¼š<span id="modal-total-items" style="color:#0d9488; font-weight:bold;">0</span></p>
            <input type="number" id="quiz-num-input" class="num-input" value="10" min="5">
            <div class="modal-btns">
                <button class="tab-btn" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="tab-btn active" onclick="confirmStartQuiz()">é–‹å§‹</button>
            </div>
        </div>
    </div>

</div>

<script>
    // ================= 1. è¶…ç´šæ“´å……è³‡æ–™åº« (130+ é¡Œ) =================
    
    const chemData = {
        "åŸºç¤å®˜èƒ½åŸºèˆ‡ç•°æ§‹ç‰©": [
            // --- é†‡é†š ---
            { type: 'image_choice', svg: `<svg viewBox="0 0 100 60"><line x1="10" y1="30" x2="40" y2="30" class="bond"/><text x="60" y="30" class="atom-o">O</text><text x="85" y="30" class="atom-h">H</text></svg>`, q: "é€™å€‹ã€Œ-OHã€çµæ§‹å±¬æ–¼ä»€éº¼å®˜èƒ½åŸºï¼Ÿ", a: "ç¾¥åŸº", o: ["ç¾§åŸº", "é†›åŸº", "ç¾°åŸº", "é†šåŸº"], exp: "ç¾¥åŸº (-OH) æ˜¯é†‡é¡èˆ‡é…šé¡çš„ç‰¹å¾µã€‚" },
            { type: 'fill', pre: "çµæ§‹å¼ç‚º R-OH çš„å®˜èƒ½åŸºç¨±ç‚º", post: "ï¼Œå…·æœ‰è¦ªæ°´æ€§ã€‚", ans: "ç¾¥åŸº", opts: ["ç¾§åŸº", "é†›åŸº", "ç¾°åŸº"], exp: "ç¾¥åŸºå¯èˆ‡æ°´å½¢æˆæ°«éµï¼Œå¢åŠ æº¶è§£åº¦ã€‚" },
            { type: 'text_choice', q: "ä¸‹åˆ—ä½•è€…èˆ‡ä¹™é†‡ (C2H5OH) äº’ç‚ºåŒåˆ†ç•°æ§‹ç‰©ï¼Ÿ", a: "ç”²é†š", o: ["ä¹™é…¸", "ä¹™é†›", "ä¸™é…®", "ä¹™çƒ·"], exp: "é†‡èˆ‡é†šé€šå¼çš†ç‚º CnH(2n+2)Oã€‚" },
            { type: 'fill', pre: "ä¹™é†šçš„çµæ§‹ç‰¹å¾µæ˜¯æ°§åŸå­é€£æ¥å…©å€‹ç¢³ï¼Œå½¢æˆ", post: "éµçµã€‚", ans: "C-O-C", opts: ["C=O", "C-OH", "C-N"], exp: "é†šåŸº (-O-) é€£æ¥å…©å€‹çƒ´åŸºã€‚" },
            { type: 'text_choice', q: "ä¸‹åˆ—å“ªä¸€ç¨®é†‡é¡ç„¡æ³•è¢«æ°§åŒ–æˆé†›æˆ–é…®ï¼Ÿ", a: "ä¸‰ç´šé†‡", o: ["ä¸€ç´šé†‡", "äºŒç´šé†‡", "ç”²é†‡", "ä¹™é†‡"], exp: "ä¸‰ç´šé†‡é€£æ¥ç¾¥åŸºçš„ç¢³ä¸Šæ²’æœ‰æ°«ï¼Œç„¡æ³•è„«æ°«æ°§åŒ–ã€‚" },
            { type: 'fill', pre: "ä¸€ç´šé†‡çš„çµæ§‹ç‰¹å¾µæ˜¯é€£æ¥ç¾¥åŸºçš„ç¢³åŸå­ä¸Šï¼Œé‚„æ¥äº†", post: "å€‹æ°«åŸå­ã€‚", ans: "2", opts: ["1", "0", "3"], exp: "R-CH2-OH ç‚ºä¸€ç´šé†‡ã€‚" },
            { type: 'text_choice', q: "ç”˜æ²¹ (Glycerol) çš„åŒ–å­¸åç¨±æ˜¯ï¼Ÿ", a: "ä¸™ä¸‰é†‡", o: ["ä¹™äºŒé†‡", "ä¸™äºŒé†‡", "ä¸™é†‡", "ä¹™é†‡"], exp: "ç”˜æ²¹çµæ§‹ç‚º 1,2,3-ä¸™ä¸‰é†‡ï¼Œä¿æ¿•æ€§ä½³ã€‚" },
            { type: 'fill', pre: "ä¹™äºŒé†‡ä¿—ç¨±", post: "ï¼Œå¸¸ç”¨æ–¼æ±½è»Šæ°´ç®±æŠ—å‡åŠ‘ã€‚", ans: "æ°´ç²¾", opts: ["é…’ç²¾", "ç”˜æ²¹", "ç¦é¦¬æ—"], exp: "ä¹™äºŒé†‡å¯é™ä½æ°´çš„å†°é»ã€‚" },
            
            // --- é†›é…® ---
            { type: 'image_choice', svg: `<svg viewBox="0 0 120 80"><line x1="10" y1="40" x2="40" y2="40" class="bond"/><text x="55" y="40" class="atom-c">C</text><line x1="65" y1="25" x2="80" y2="10" class="bond"/><text x="90" y="10" class="atom-o">O</text><line x1="70" y1="30" x2="85" y2="15" class="bond"/><line x1="65" y1="50" x2="80" y2="65" class="bond"/><text x="90" y="70" class="atom-h">H</text></svg>`, q: "ã€Œ-CHOã€æ˜¯å“ªç¨®å®˜èƒ½åŸºï¼Ÿ", a: "é†›åŸº", o: ["é…®åŸº", "ç¾§åŸº", "é…¯åŸº", "é†¯èƒºåŸº"], exp: "é†›åŸºä½æ–¼ç¢³éˆæœ«ç«¯ï¼Œå…·é‚„åŸæ€§ã€‚" },
            { type: 'fill', pre: "é†›åŸºçš„çµæ§‹å¼ç‚º", post: "ï¼Œå…·æœ‰é‚„åŸæ€§ã€‚", ans: "-CHO", opts: ["-COOH", "-OH", "-COO-"], exp: "æ³¨æ„å¯«æ³•ï¼Œç¢³æ°§é›™éµä¸”æ¥ä¸€å€‹æ°«ã€‚" },
            { type: 'text_choice', q: "ä¸™é…® (Acetone) èˆ‡ä¸‹åˆ—ä½•è€…äº’ç‚ºåŒåˆ†ç•°æ§‹ç‰©ï¼Ÿ", a: "ä¸™é†›", o: ["ä¸™é…¸", "ä¸™é†‡", "ä¸™é†š", "ä¸™ç‚”"], exp: "é†›èˆ‡é…®é€šå¼çš†ç‚º CnH2nOã€‚" },
            { type: 'fill', pre: "æœ€ç°¡å–®çš„é…®é¡æ˜¯", post: "ï¼Œå¸¸ç”¨ä½œæœ‰æ©Ÿæº¶åŠ‘ã€‚", ans: "ä¸™é…®", opts: ["ç”²é…®", "ä¹™é…®", "ä¸é…®"], exp: "é…®åŸºå¿…é ˆå¤¾åœ¨å…©å€‹ç¢³ä¸­é–“ï¼Œæ‰€ä»¥æœ€å°çš„é…®æ˜¯ä¸‰å€‹ç¢³(ä¸™é…®)ã€‚" },
            { type: 'text_choice', q: "ä¸‹åˆ—ä½•è€…å…·æœ‰é‚„åŸåŠ›ï¼Œå¯ä½¿æ–æ—è©¦åŠ‘è®Šè‰²ï¼Ÿ", a: "ä¹™é†›", o: ["ä¸™é…®", "ä¹™é…¸", "ä¹™é†š", "ä¹™é†‡"], exp: "é†›é¡æœ‰é‚„åŸåŠ›ï¼Œé…®é¡æ²’æœ‰ã€‚" },
            { type: 'fill', pre: "ç”²é†›çš„æ°´æº¶æ¶²ä¿—ç¨±", post: "ï¼Œå…·æœ‰é˜²è…ä½œç”¨ã€‚", ans: "ç¦é¦¬æ—", opts: ["é…’ç²¾", "ç”˜æ²¹", "é›™æ°§æ°´"], exp: "37% ç”²é†›æ°´æº¶æ¶²ç‚ºç¦é¦¬æ—ï¼Œä½¿è›‹ç™½è³ªè®Šæ€§ã€‚" },

            // --- é…¸é…¯ ---
            { type: 'image_choice', svg: `<svg viewBox="0 0 120 80"><line x1="10" y1="40" x2="40" y2="40" class="bond"/><text x="55" y="40" class="atom-c">C</text><line x1="65" y1="25" x2="80" y2="10" class="bond"/><text x="90" y="10" class="atom-o">O</text><line x1="70" y1="30" x2="85" y2="15" class="bond"/><line x1="65" y1="50" x2="80" y2="65" class="bond"/><text x="90" y="70" class="atom-o">O</text><text x="110" y="70" class="atom-h">H</text></svg>`, q: "ã€Œ-COOHã€çµæ§‹æ˜¯ï¼Ÿ", a: "ç¾§åŸº", o: ["é…¯åŸº", "é†›åŸº", "ç¾¥åŸº", "èƒºåŸº"], exp: "ç¾§åŸºé¡¯å¼±é…¸æ€§ã€‚" },
            { type: 'fill', pre: "æœ‰æ©Ÿé…¸å¿…å®šå«æœ‰", post: "å®˜èƒ½åŸºï¼Œå‘ˆå¼±é…¸æ€§ã€‚", ans: "ç¾§åŸº", opts: ["é…¯åŸº", "ç¾¥åŸº", "é†›åŸº"], exp: "ç¾§åŸºè§£é›¢å‡ºæ°«é›¢å­ã€‚" },
            { type: 'image_choice', svg: `<svg viewBox="0 0 120 80"><text x="20" y="40" class="atom-c">C</text><line x1="35" y1="25" x2="50" y2="10" class="bond"/><text x="60" y="10" class="atom-o">O</text><line x1="40" y1="30" x2="55" y2="15" class="bond"/><line x1="30" y1="50" x2="50" y2="65" class="bond"/><text x="60" y="70" class="atom-o">O</text><line x1="75" y1="70" x2="95" y2="70" class="bond"/><text x="105" y="70" class="atom-c">C</text></svg>`, q: "çœ‹åˆ°ã€Œ-COO-ã€çµæ§‹ï¼Œé€šå¸¸å…·æœ‰é¦™å‘³ï¼Œå®ƒæ˜¯ï¼Ÿ", a: "é…¯åŸº", o: ["ç¾§åŸº", "é†šåŸº", "é…®åŸº", "é†¯èƒºåŸº"], exp: "é…¯åŸºå¸¸è¦‹æ–¼æ°´æœé¦™æ°£ã€‚" },
            { type: 'text_choice', q: "åˆ†å­å¼ C2H4O2 å¯èƒ½ç‚ºä¸‹åˆ—ä½•è€…ï¼Ÿ", a: "ä¹™é…¸", o: ["ä¹™é†›", "ä¹™é†‡", "ä¹™é†š", "ä¹™çƒ·"], exp: "é…¸èˆ‡é…¯é€šå¼ç‚º CnH2nO2ã€‚" },
            { type: 'fill', pre: "ä¹™é…¸èˆ‡ä¹™é†‡åæ‡‰æœƒç”Ÿæˆ", post: "ï¼Œå…·æœ‰æ°´æœé¦™å‘³ã€‚", ans: "ä¹™é…¸ä¹™é…¯", opts: ["ç”²é…¸ç”²é…¯", "ä¹™é…¸ç”²é…¯", "ç”²é…¸ä¹™é…¯"], exp: "é…¸åŠ é†‡ç”Ÿæˆé…¯åŠ æ°´ã€‚" },
            { type: 'text_choice', q: "èèŸ»å®å’¬åˆ†æ³Œçš„é…¸æ€§ç‰©è³ªæ˜¯ï¼Ÿ", a: "ç”²é…¸", o: ["ä¹™é…¸", "è‰é…¸", "é¹½é…¸", "ç¡«é…¸"], exp: "ç”²é…¸ä¿—ç¨±èŸ»é…¸ã€‚" },
            { type: 'fill', pre: "ä¹™äºŒé…¸ä¿—ç¨±", post: "ï¼Œå¯ç”¨æ–¼é™¤é½ã€‚", ans: "è‰é…¸", opts: ["èŸ»é…¸", "é†‹é…¸", "ä¹³é…¸"], exp: "ä¹™äºŒé…¸æœ‰é‚„åŸæ€§ï¼Œå¯å»é™¤éµé½ã€‚" },
            { type: 'text_choice', q: "é„°è‹¯äºŒç”²é…¸åŠ ç†±è„«æ°´æœƒå½¢æˆï¼Ÿ", a: "é…¸é…", o: ["é…¯é¡", "é†šé¡", "é…®é¡", "é†›é¡"], exp: "é„°ä½äºŒç¾§é…¸åŠ ç†±æ˜“è„«æ°´æˆé…ã€‚" },

            // --- èƒºèˆ‡é†¯èƒº ---
            { type: 'image_choice', svg: `<svg viewBox="0 0 100 60"><line x1="10" y1="30" x2="40" y2="30" class="bond"/><text x="55" y="30" class="atom-n">N</text><text x="80" y="15" class="atom-h">H</text><text x="80" y="45" class="atom-h">H</text></svg>`, q: "ã€Œ-NHâ‚‚ã€çµæ§‹ç¨±ç‚ºä»€éº¼ï¼Ÿ", a: "èƒºåŸº", o: ["é†¯èƒºåŸº", "ç¡åŸº", "æ°¨åŸº", "ç¾§åŸº"], exp: "èƒºåŸºé¡¯å¼±é¹¼æ€§ã€‚" },
            { type: 'fill', pre: "èƒºé¡åŒ–åˆç‰© (R-NHâ‚‚) æ°´æº¶æ¶²å‘ˆå¼±", post: "æ€§ã€‚", ans: "é¹¼", opts: ["é…¸", "ä¸­", "å…©"], exp: "æ°®ä¸Šçš„å­¤å°é›»å­å¯æ¥å—è³ªå­ã€‚" },
            { type: 'image_choice', svg: `<svg viewBox="0 0 140 80"><text x="20" y="40" class="atom-c">C</text><line x1="30" y1="25" x2="45" y2="10" class="bond"/><text x="55" y="10" class="atom-o">O</text><line x1="35" y1="30" x2="50" y2="15" class="bond"/><line x1="30" y1="50" x2="50" y2="50" class="bond"/><text x="65" y="50" class="atom-n">N</text><text x="85" y="50" class="atom-h">H</text><line x1="95" y1="50" x2="115" y2="50" class="bond"/></svg>`, q: "ã€Œ-CONH-ã€çµæ§‹åœ¨è›‹ç™½è³ªä¸­è¢«ç¨±ç‚ºï¼Ÿ", a: "è‚½éµ", o: ["æ°«éµ", "é›¢å­éµ", "é…¯éµ", "é›™ç¡«éµ"], exp: "è‚½éµå³ç‚ºé†¯èƒºéµã€‚" },
            { type: 'fill', pre: "é†¯èƒºåŸº (-CONH2) çš„æ°´æº¶æ¶²å‘ˆ", post: "æ€§ã€‚", ans: "ä¸­", opts: ["é…¸", "é¹¼", "å…©"], exp: "é›–ç„¶å«æ°®ï¼Œä½†å—ç¾°åŸºå½±éŸ¿ï¼Œä¸å…·é¹¼æ€§ã€‚" },
            { type: 'text_choice', q: "å°¿ç´ çš„çµæ§‹ä¸­å«æœ‰å¹¾å€‹é†¯èƒºåŸºï¼Ÿ", a: "2å€‹", o: ["1å€‹", "3å€‹", "0å€‹", "4å€‹"], exp: "å°¿ç´  (NH2)2CO è¦–ç‚ºç¢³é…¸çš„é›™é†¯èƒºã€‚" },
            { type: 'fill', pre: "è‹¯èƒºé›£æº¶æ–¼æ°´ï¼Œä½†å¯æº¶æ–¼", post: "ã€‚", ans: "é¹½é…¸", opts: ["æ°«æ°§åŒ–éˆ‰", "é£Ÿé¹½æ°´", "é…’ç²¾"], exp: "è‹¯èƒºæ˜¯é¹¼ï¼Œé‡é…¸ç”Ÿæˆé¹½é¡æº¶æ–¼æ°´ã€‚" },

            // --- çƒ´é¡èˆ‡è‹¯ ---
            { tag: 'functional', pre: "çƒ·çƒ´çš„é€šå¼ç‚º", post: "ï¼Œå±¬æ–¼é£½å’Œçƒ´ã€‚", ans: "CnH2n+2", opts: ["CnH2n", "CnH2n-2", "CnHn"], exp: "é£½å’Œéˆç‹€çƒ´é€šå¼ã€‚" },
            { tag: 'functional', pre: "çƒ¯çƒ´å«æœ‰ç¢³ç¢³", post: "éµï¼Œå±¬æ–¼ä¸é£½å’Œçƒ´ã€‚", ans: "é›™", opts: ["å–®", "åƒ", "é›¢å­"], exp: "çƒ¯çƒ´å« C=Cã€‚" },
            { tag: 'functional', pre: "ç‚”çƒ´å«æœ‰ç¢³ç¢³", post: "éµã€‚", ans: "åƒ", opts: ["é›™", "å–®", "æ°«"], exp: "ç‚”çƒ´å« Câ‰¡Cã€‚" },
            { type: 'image_choice', svg: `<svg viewBox="0 0 100 100"><polygon points="50,10 85,30 85,70 50,90 15,70 15,30" fill="none" stroke="#333" stroke-width="3"/><circle cx="50" cy="50" r="20" fill="none" stroke="#333" stroke-width="2"/></svg>`, q: "é€™å€‹çµæ§‹æ˜¯ï¼Ÿ", a: "è‹¯", o: ["ç’°å·±çƒ·", "æ­£å·±çƒ·", "è˜", "é…š"], exp: "èŠ³é¦™çƒ´çš„åŸºç¤çµæ§‹ã€‚" },
            { tag: 'functional', pre: "è‹¯åˆ†å­ä¸­çš„ç¢³ç¢³éµçµé•·åº¦ä»‹æ–¼", post: "ä¹‹é–“ã€‚", ans: "å–®éµèˆ‡é›™éµ", opts: ["é›™éµèˆ‡åƒéµ", "å–®éµèˆ‡æ°«éµ"], exp: "å…·å…±æŒ¯çµæ§‹ï¼Œéµç´š1.5ã€‚" },
            { type: 'text_choice', q: "ä¸‹åˆ—ä½•è€…ç‚ºèŠ³é¦™çƒ´ï¼Ÿ", a: "ç”²è‹¯", o: ["ç’°å·±çƒ·", "å·±çƒ¯", "ä¹™ç‚”", "ä¸™çƒ·"], exp: "ç”²è‹¯å«æœ‰è‹¯ç’°çµæ§‹ã€‚" },
            { type: 'text_choice', q: "è˜ (Naphthalene) çš„åˆ†å­å¼ç‚ºï¼Ÿ", a: "C10H8", o: ["C6H6", "C10H10", "C12H10", "C14H10"], exp: "å…©å€‹è‹¯ç’°å…±ç”¨å…©å€‹ç¢³åŸå­ã€‚" },
            { type: 'text_choice', q: "å€åˆ¥ç’°å·±çƒ¯èˆ‡è‹¯ï¼Œå¯ä½¿ç”¨ï¼Ÿ", a: "æº´æ°´", o: ["æ°´", "çŸ³è•Šè©¦ç´™", "æ–æ—è©¦åŠ‘", "é¹½é…¸"], exp: "ç’°å·±çƒ¯(çƒ¯é¡)ä½¿æº´æ°´è¤ªè‰²(åŠ æˆ)ï¼Œè‹¯ä¸åæ‡‰ã€‚" },
            { type: 'fill', pre: "é›»çŸ³æ°£æ˜¯æŒ‡", post: "ã€‚", ans: "ä¹™ç‚”", opts: ["ä¹™çƒ¯", "ç”²çƒ·", "ä¸™çƒ·"], exp: "ç¢³åŒ–éˆ£(é›»çŸ³)åŠ æ°´ç”¢ç”Ÿä¹™ç‚”ã€‚" },
            { type: 'text_choice', q: "å¤©ç„¶æ°£çš„ä¸»è¦æˆåˆ†æ˜¯ï¼Ÿ", a: "ç”²çƒ·", o: ["ä¹™çƒ·", "ä¸™çƒ·", "ä¸çƒ·", "æ°«æ°£"], exp: "æ¶²åŒ–å¤©ç„¶æ°£(LNG)ä¸»æˆåˆ†ç”²çƒ·ã€‚" },
            { type: 'text_choice', q: "æ¶²åŒ–çŸ³æ²¹æ°£(LPG)çš„ä¸»è¦æˆåˆ†æ˜¯ï¼Ÿ", a: "ä¸™çƒ·èˆ‡ä¸çƒ·", o: ["ç”²çƒ·", "ä¹™çƒ·", "æ°«æ°£", "ä¹™ç‚”"], exp: "æ¡¶è£ç“¦æ–¯ä¸»æˆåˆ†ã€‚" },
            { type: 'fill', pre: "é¹µä»£çƒ´çš„å¯†åº¦é€šå¸¸æ¯”æ°´", post: "ã€‚", ans: "å¤§", opts: ["å°", "ä¸€æ¨£"], exp: "å«é¹µç´ çš„æœ‰æ©Ÿç‰©é€šå¸¸æ²‰åœ¨æ°´åº•(é™¤æ°ŸåŒ–ç‰©)ã€‚" }
        ],

        "ç”Ÿæ´»èˆ‡ç’°å¢ƒåŒ–å­¸": [
            // --- è—¥ç‰© ---
            { type: 'text_choice', q: "é˜¿æ–¯åŒ¹éˆæ˜¯ç”±æ°´æ¥Šé…¸èˆ‡ä½•è€…åæ‡‰è£½æˆï¼Ÿ", a: "ä¹™é…", o: ["ä¹™é†‡", "ä¹™é…¸", "ç”²é†‡", "ä¸™é…®"], exp: "é…¯åŒ–åæ‡‰ã€‚" },
            { type: 'fill', pre: "é˜¿æ–¯åŒ¹éˆå…·æœ‰è§£ç†±é®ç—›åŠ", post: "çš„åŠŸæ•ˆã€‚", ans: "æŠ—å‡è¡€", opts: ["æŠ—ç”Ÿç´ ", "æŠ—ç™Œ", "æŠ—éæ•"], exp: "å¯é é˜²è¡€æ “ã€‚" },
            { type: 'text_choice', q: "ç›¤å°¼è¥¿æ— (Penicillin) çš„ä½œç”¨æ©Ÿåˆ¶æ˜¯ï¼Ÿ", a: "æŠ‘åˆ¶ç´°èŒç´°èƒå£åˆæˆ", o: ["ç ´å£ç´°èƒè†œ", "æŠ‘åˆ¶è›‹ç™½è³ªåˆæˆ", "å¹²æ“¾DNAè¤‡è£½", "ç ´å£ç²’ç·šé«”"], exp: "ç´°èŒå¤±å»ç´°èƒå£ä¿è­·è€Œç ´è£‚ã€‚" },
            { type: 'fill', pre: "ç£ºèƒºè—¥æ˜¯", post: "è—¥ç‰©ï¼Œæ›¾ç”¨æ–¼äºŒæˆ°ã€‚", ans: "æŠ—èŒ", opts: ["æŠ—ç—…æ¯’", "æ­¢ç—›", "éº»é†‰"], exp: "äººå·¥åˆæˆçš„æŠ—èŒåŠ‘ã€‚" },
            { type: 'text_choice', q: "èƒƒè—¥ä¸­çš„åˆ¶é…¸åŠ‘å¸¸å«æœ‰ï¼Ÿ", a: "æ°«æ°§åŒ–é‹æˆ–æ°«æ°§åŒ–é‚", o: ["æ°«æ°§åŒ–éˆ‰", "é¹½é…¸", "ç¡«é…¸", "æ°¨æ°´"], exp: "å¼±é¹¼ä¸­å’Œèƒƒé…¸ã€‚" },
            { type: 'fill', pre: "èŒ¶é¹¼å¸¸ç”¨æ–¼æ²»ç™‚", post: "ã€‚", ans: "æ°£å–˜", opts: ["é ­ç—›", "èƒƒç—›", "æ„Ÿå†’"], exp: "æ”¯æ°£ç®¡æ“´å¼µåŠ‘ã€‚" },
            
            // --- æ¸…æ½”åŠ‘ ---
            { type: 'fill', pre: "è‚¥çš‚åœ¨ç¡¬æ°´ä¸­ç”¢ç”Ÿ", post: "ï¼Œå½±éŸ¿æ´—æ»Œã€‚", ans: "çš‚å¢", opts: ["æ³¡æ²«", "ç”˜æ²¹", "é…¸æ€§ç‰©è³ª"], exp: "è„‚è‚ªé…¸éˆ£/é‚æ²‰æ¾±ã€‚" },
            { type: 'text_choice', q: "è‚¥çš‚çš„è£½é€ åæ‡‰ç¨±ç‚ºï¼Ÿ", a: "çš‚åŒ–", o: ["é…¯åŒ–", "ä¸­å’Œ", "èšåˆ", "æ°§åŒ–"], exp: "æ²¹è„‚ + å¼·é¹¼ -> è‚¥çš‚ + ç”˜æ²¹ã€‚" },
            { type: 'text_choice', q: "åˆæˆæ¸…æ½”åŠ‘è‹¥æ”¯éˆéå¤šï¼Œå®¹æ˜“é€ æˆï¼Ÿ", a: "æ³¡æ²«æ±™æŸ“", o: ["å„ªé¤ŠåŒ–", "é…¸é›¨", "æº«å®¤æ•ˆæ‡‰", "è‡­æ°§ç ´æ´"], exp: "å¾®ç”Ÿç‰©é›£åˆ†è§£æ”¯éˆçƒ·åŸºã€‚" },
            { type: 'fill', pre: "æ¸…æ½”åŠ‘æ·»åŠ ", post: "æœƒå°è‡´æ²³å·å„ªé¤ŠåŒ–ã€‚", ans: "ç£·é…¸é¹½", opts: ["ç¢³é…¸é¹½", "ç¡«é…¸é¹½", "çŸ½é…¸é¹½"], exp: "ç£·æ˜¯è—»é¡ç‡Ÿé¤Šæºã€‚" },
            { type: 'fill', pre: "æ¼‚ç™½æ°´çš„ä¸»è¦æˆåˆ†æ˜¯", post: "ã€‚", ans: "æ¬¡æ°¯é…¸éˆ‰", opts: ["é›™æ°§æ°´", "è‡­æ°§", "äºŒæ°§åŒ–æ°¯"], exp: "æ°¯ç³»æ¼‚ç™½æ°´ã€‚" },
            { type: 'text_choice', q: "æ¼‚ç™½æ°´ä¸å¯èˆ‡ä½•è€…æ··ç”¨ï¼Œä»¥å…ç”¢ç”Ÿæ¯’æ°£ï¼Ÿ", a: "é¹½é…¸ (é…¸æ€§æ¸…æ½”åŠ‘)", o: ["è‚¥çš‚", "æ´—è¡£ç²‰", "è˜‡æ‰“ç²‰", "ç†±æ°´"], exp: "ç”¢ç”Ÿæ°¯æ°£ (Cl2)ã€‚" },

            // --- èšåˆç‰© ---
            { type: 'text_choice', q: "ä¸‹åˆ—ä½•è€…ç‚ºç†±å›ºæ€§å¡‘è† ï¼Ÿ", a: "é…šé†›æ¨¹è„‚ (é›»æœ¨)", o: ["PE", "PVC", "PS", "PET"], exp: "ç¶²ç‹€çµæ§‹ï¼ŒåŠ ç†±ä¸ç†”åŒ–ã€‚" },
            { type: 'fill', pre: "è€ç¶¸ (Nylon) æ˜¯é€é", post: "èšåˆåæ‡‰è£½æˆã€‚", ans: "ç¸®åˆ", opts: ["åŠ æˆ", "é›¢å­", "é–‹ç’°"], exp: "é…¸ + èƒº è„«æ°´ç¸®åˆã€‚" },
            { type: 'fill', pre: "PET (å¯¶ç‰¹ç“¶) å±¬æ–¼", post: "çº–ç¶­ã€‚", ans: "èšé…¯", opts: ["èšé†¯èƒº", "èšçƒ¯çƒ´", "èšé†š"], exp: "ç”±å°è‹¯äºŒç”²é…¸èˆ‡ä¹™äºŒé†‡ç¸®åˆã€‚" },
            { type: 'text_choice', q: "ç‡ƒç‡’æ™‚æœƒç”¢ç”Ÿæˆ´å¥§è¾›çš„å¡‘è† æ˜¯ï¼Ÿ", a: "PVC", o: ["PE", "PP", "PET", "PS"], exp: "å«æ°¯å¡‘è† ç‡ƒç‡’æ˜“ç”Ÿæ¯’ã€‚" },
            { type: 'fill', pre: "å¤©ç„¶æ©¡è† çš„å–®é«”æ˜¯", post: "ã€‚", ans: "ç•°æˆŠäºŒçƒ¯", opts: ["æ°¯ä¸äºŒçƒ¯", "è‹¯ä¹™çƒ¯", "ä¹™çƒ¯"], exp: "èšç•°æˆŠäºŒçƒ¯ã€‚" },
            { type: 'text_choice', q: "æ©¡è† ç¡«åŒ–çš„ç›®çš„æ˜¯ï¼Ÿ", a: "å¢åŠ å½ˆæ€§èˆ‡è€ç†±", o: ["å¢åŠ ç¡¬åº¦", "æ”¹è®Šé¡è‰²", "é™ä½æˆæœ¬", "å¢åŠ é»æ€§"], exp: "ç¡«åŸå­å½¢æˆäº¤è¯çµæ§‹ã€‚" },
            { type: 'fill', pre: "ä¸æ²¾é‹å¡—å±¤éµæ°Ÿé¾çš„å–®é«”æ˜¯", post: "ã€‚", ans: "å››æ°Ÿä¹™çƒ¯", opts: ["ä¹™çƒ¯", "æ°¯ä¹™çƒ¯", "è‹¯ä¹™çƒ¯"], exp: "è€ç†±è€é…¸é¹¼ã€‚" },
            { type: 'text_choice', q: "ä¿éº—é¾ (PS) æ˜“æº¶æ–¼ï¼Ÿ", a: "ç”²è‹¯ / æŸ‘æ©˜æ²¹", o: ["æ°´", "é…’ç²¾", "é†‹é…¸", "é¹½é…¸"], exp: "æœ‰æ©Ÿæº¶åŠ‘æº¶è§£ã€‚" },

            // --- ç”Ÿç‰©åˆ†å­ ---
            { type: 'fill', pre: "è‘¡è„ç³–å«æœ‰", post: "åŸºï¼Œå…·é‚„åŸæ€§ã€‚", ans: "é†›", opts: ["é…®", "é…¸", "é…¯"], exp: "é†›åŸºå¯è¢«æ°§åŒ–ã€‚" },
            { type: 'text_choice', q: "è”—ç³–æ°´è§£å¾Œç”¢ç”Ÿï¼Ÿ", a: "è‘¡è„ç³– + æœç³–", o: ["å…©åˆ†å­è‘¡è„ç³–", "è‘¡è„ç³– + åŠä¹³ç³–", "å…©åˆ†å­æœç³–", "æ¾±ç²‰"], exp: "è”—ç³–æ˜¯é›™é†£ã€‚" },
            { type: 'fill', pre: "æ¾±ç²‰èˆ‡çº–ç¶­ç´ çš„å–®é«”éƒ½æ˜¯", post: "ã€‚", ans: "è‘¡è„ç³–", opts: ["æœç³–", "è”—ç³–", "èƒºåŸºé…¸"], exp: "é€£çµæ–¹å¼ä¸åŒ(alpha vs beta)ã€‚" },
            { type: 'text_choice', q: "æª¢é©—æ¾±ç²‰ä½¿ç”¨ï¼Ÿ", a: "ç¢˜æ¶²", o: ["æ–æ—è©¦åŠ‘", "æœ¬æ°æ¶²", "é›™ç¸®è„²è©¦åŠ‘", "æº´æ°´"], exp: "å‘ˆè—é»‘è‰²ã€‚" },
            { type: 'fill', pre: "è›‹ç™½è³ªç”±", post: "èšåˆè€Œæˆã€‚", ans: "èƒºåŸºé…¸", opts: ["è‘¡è„ç³–", "æ ¸è‹·é…¸", "è„‚è‚ªé…¸"], exp: "è‚½éµé€£æ¥ã€‚" },
            { type: 'text_choice', q: "æª¢é©—è›‹ç™½è³ªä½¿ç”¨ï¼Ÿ", a: "é›™ç¸®è„²è©¦åŠ‘", o: ["æ–æ—è©¦åŠ‘", "ç¢˜æ¶²", "çŸ³è•Š", "é…šé…"], exp: "å‘ˆç´«è‰²åæ‡‰ã€‚" },
            { type: 'fill', pre: "DNA èˆ‡ RNA çš„äº”ç¢³é†£å·®ç•°åœ¨æ–¼ DNA æ˜¯", post: "ã€‚", ans: "å»æ°§æ ¸ç³–", opts: ["æ ¸ç³–", "è‘¡è„ç³–", "æœç³–"], exp: "2è™Ÿç¢³å°‘ä¸€å€‹æ°§ã€‚" },
            { type: 'text_choice', q: "DNA ä¸­ A èˆ‡èª°é…å°ï¼Ÿ", a: "T", o: ["C", "G", "U", "A"], exp: "A-T, C-Gã€‚" },

            // --- ç’°å¢ƒèˆ‡èƒ½æº ---
            { type: 'fill', pre: "æ±½æ²¹è¾›çƒ·å€¼ä»£è¡¨", post: "èƒ½åŠ›ã€‚", ans: "æŠ—éœ‡çˆ†", opts: ["ç‡ƒç‡’", "æ½¤æ»‘", "æ®ç™¼"], exp: "95ç„¡é‰›ä»£è¡¨æŠ—éœ‡çˆ†ç­‰æ–¼95%ç•°è¾›çƒ·ã€‚" },
            { type: 'text_choice', q: "é…¸é›¨çš„ä¸»è¦æˆå› æ°£é«”ï¼Ÿ", a: "SOx èˆ‡ NOx", o: ["CO2", "CH4", "CFCs", "O3"], exp: "ç¡«æ°§åŒ–ç‰©èˆ‡æ°®æ°§åŒ–ç‰©ã€‚" },
            { type: 'fill', pre: "æº«å®¤æ•ˆæ‡‰ä¸»è¦äººç‚ºæ°£é«”æ˜¯", post: "ã€‚", ans: "äºŒæ°§åŒ–ç¢³", opts: ["ç”²çƒ·", "è‡­æ°§", "æ°´æ°£"], exp: "ç‡ƒç‡’åŒ–çŸ³ç‡ƒæ–™ç”¢ç”Ÿã€‚" },
            { type: 'text_choice', q: "è‡­æ°§å±¤ç ´æ´å…ƒå…‡ï¼Ÿ", a: "æ°Ÿæ°¯ç¢³åŒ–ç‰© (CFCs)", o: ["ç”²çƒ·", "CO2", "NOx", "SO2"], exp: "æ°¯åŸå­å‚¬åŒ–åˆ†è§£è‡­æ°§ã€‚" },
            { type: 'fill', pre: "å…‰åŒ–å­¸ç…™éœ§å«æœ‰", post: "èˆ‡ PANsã€‚", ans: "è‡­æ°§", opts: ["ç¡«é…¸", "ç¢³é…¸", "æ°¨"], exp: "æ°®æ°§åŒ–ç‰©å…‰è§£ç”¢ç”Ÿã€‚" },
            { type: 'text_choice', q: "è‡ªä¾†æ°´æ¶ˆæ¯’æ°£é«”ï¼Ÿ", a: "æ°¯æ°£", o: ["æ°¨æ°£", "æ°«æ°£", "æ°®æ°£", "æ°§æ°£"], exp: "ç”Ÿæˆæ¬¡æ°¯é…¸æ®ºèŒã€‚" },
            { type: 'fill', pre: "ç”Ÿè³ªæŸ´æ²¹ä¸»è¦æˆåˆ†æ˜¯", post: "ã€‚", ans: "è„‚è‚ªé…¸ç”²é…¯", opts: ["çƒ·é¡", "é†‡é¡", "é†šé¡"], exp: "æ²¹è„‚è½‰é…¯åŒ–ã€‚" },
            { type: 'text_choice', q: "PM2.5 æ˜¯æŒ‡ç²’å¾‘å°æ–¼ï¼Ÿ", a: "2.5 å¾®ç±³", o: ["2.5 å¥ˆç±³", "2.5 æ¯«ç±³", "2.5 å…¬åˆ†", "2.5 Ã…"], exp: "å¯å…¥è‚ºé¡†ç²’ç‰©ã€‚" }
        ],

        "é€²éšæœ‰æ©Ÿåæ‡‰èˆ‡é‘‘åˆ¥": [
            { type: 'fill', pre: "ä¸€ç´šé†‡æ°§åŒ–å…ˆç”Ÿæˆ", post: "ï¼Œå†æ°§åŒ–æˆé…¸ã€‚", ans: "é†›", opts: ["é…®", "é…¯", "é†š"], exp: "ä¸€ç´šé†‡ -> é†› -> é…¸ã€‚" },
            { type: 'fill', pre: "äºŒç´šé†‡æ°§åŒ–ç”Ÿæˆ", post: "ã€‚", ans: "é…®", opts: ["é†›", "é…¸", "é†š"], exp: "é…®é›£ä»¥å†æ°§åŒ–ã€‚" },
            { type: 'text_choice', q: "ä¸‰ç´šé†‡æ˜¯å¦å®¹æ˜“è¢«æ°§åŒ–ï¼Ÿ", a: "å¦", o: ["æ˜¯", "è¦–å‚¬åŒ–åŠ‘è€Œå®š", "åŠ ç†±å¯ä»¥", "åŠ é…¸å¯ä»¥"], exp: "ç¼ºä¹ alpha-æ°«ã€‚" },
            { type: 'fill', pre: "å¤šå€«è©¦åŠ‘ (éŠ€é¡åæ‡‰) ç”¨æ–¼æª¢é©—", post: "ã€‚", ans: "é†›åŸº", opts: ["é…®åŸº", "ç¾§åŸº", "ç¾¥åŸº"], exp: "é†›è¢«æ°§åŒ–ï¼ŒéŠ€é›¢å­é‚„åŸã€‚" },
            { type: 'text_choice', q: "æ–æ—è©¦åŠ‘èˆ‡é†›å…±ç†±ç”¢ç”Ÿï¼Ÿ", a: "ç´…è‰² Cu2O", o: ["éŠ€é¡", "è—è‰² Cu(OH)2", "é»‘è‰² CuO", "ç™½è‰²æ²‰æ¾±"], exp: "éŠ…é›¢å­é‚„åŸã€‚" },
            { type: 'fill', pre: "ç›§å¡æ–¯è©¦åŠ‘ç”¨ä¾†åˆ†è¾¨", post: "ã€‚", ans: "é†‡é¡", opts: ["é…¸é¡", "èƒºé¡", "çƒ´é¡"], exp: "åˆ†è¾¨ä¸€ã€äºŒã€ä¸‰ç´šé†‡ã€‚" },
            { type: 'text_choice', q: "ä¹™é…¸èˆ‡ä¹™é†‡é…¯åŒ–åæ‡‰éœ€åŠ å…¥ï¼Ÿ", a: "æ¿ƒç¡«é…¸", o: ["æ¿ƒé¹½é…¸", "æ°«æ°§åŒ–éˆ‰", "æ°´", "éµç²‰"], exp: "å‚¬åŒ–åŠ‘å…¼è„«æ°´åŠ‘ã€‚" },
            { type: 'fill', pre: "æ²¹è„‚çš‚åŒ–æ˜¯", post: "æ°´è§£ã€‚", ans: "é¹¼æ€§", opts: ["é…¸æ€§", "ä¸­æ€§", "é«˜æº«"], exp: "ä¸å¯é€†åæ‡‰ã€‚" },
            { type: 'text_choice', q: "ä¹™çƒ¯åŠ æ°´ (é…¸å‚¬åŒ–) ç”Ÿæˆï¼Ÿ", a: "ä¹™é†‡", o: ["ä¹™é†›", "ä¹™é…¸", "ä¹™é†š", "ä¹™çƒ·"], exp: "çƒ¯é¡åŠ æˆåæ‡‰ã€‚" },
            { type: 'fill', pre: "ä¹™ç‚”åŠ æ°´ (Hg2+ å‚¬åŒ–) ç”Ÿæˆ", post: "ã€‚", ans: "ä¹™é†›", opts: ["ä¹™é†‡", "ä¹™é…¸", "ä¸™é…®"], exp: "çƒ¯é†‡äº’è®Šç•°æ§‹ã€‚" },
            { type: 'text_choice', q: "è‹¯èˆ‡æ¿ƒç¡é…¸/æ¿ƒç¡«é…¸åæ‡‰ç”Ÿæˆï¼Ÿ", a: "ç¡åŸºè‹¯", o: ["è‹¯ç£ºé…¸", "æ°¯è‹¯", "ç”²è‹¯", "è‹¯èƒº"], exp: "ç¡åŒ–åæ‡‰ (å–ä»£)ã€‚" },
            { type: 'fill', pre: "ç”²è‹¯æ°§åŒ–ç”Ÿæˆ", post: "ã€‚", ans: "è‹¯ç”²é…¸", opts: ["è‹¯é…š", "è‹¯ç”²é†›", "è‹¯ä¹™é…¸"], exp: "çƒ·åŸºè‹¯æ°§åŒ–çš†å¾—è‹¯ç”²é…¸ã€‚" },
            { type: 'text_choice', q: "æª¢é©—é…šé¡ä½¿ç”¨ï¼Ÿ", a: "æ°¯åŒ–éµ", o: ["æº´æ°´", "å¤šå€«è©¦åŠ‘", "æ–æ—è©¦åŠ‘", "çŸ³è•Š"], exp: "å‘ˆç´«è‰²éŒ¯åˆç‰©ã€‚" },
            { type: 'fill', pre: "è‹¯é…šä¿—ç¨±", post: "ã€‚", ans: "çŸ³ç‚­é…¸", opts: ["èŸ»é…¸", "é†‹é…¸", "æ°´æ¥Šé…¸"], exp: "å¼±é…¸æ€§ã€‚" },
            { type: 'text_choice', q: "ä¹™ç‚”é«˜æº«èšåˆç”Ÿæˆï¼Ÿ", a: "è‹¯", o: ["èšä¹™ç‚”", "ç’°å·±çƒ·", "ä¹™çƒ¯", "ç”²çƒ·"], exp: "ä¸‰åˆ†å­èšåˆã€‚" },
            { type: 'fill', pre: "é¹µä»£çƒ´èˆ‡æ°«æ°§åŒ–éˆ‰æ°´æº¶æ¶²å…±ç†±ç™¼ç”Ÿ", post: "åæ‡‰ã€‚", ans: "å–ä»£", opts: ["æ¶ˆå»", "åŠ æˆ", "é…¯åŒ–"], exp: "ç”Ÿæˆé†‡ (è‹¥ç”¨é…’ç²¾æº¶æ¶²å‰‡æ¶ˆå»ç”Ÿæˆçƒ¯)ã€‚" },
            { type: 'text_choice', q: "å€åˆ¥ä¹™çƒ·èˆ‡ä¹™çƒ¯å¯ä½¿ç”¨ï¼Ÿ", a: "æº´æ°´", o: ["æ°´", "çŸ³è•Š", "æ–æ—", "é¹½é…¸"], exp: "ä¹™çƒ¯åŠ æˆè¤ªè‰²ã€‚" },
            { type: 'fill', pre: "æ°´æ¥Šé…¸èˆ‡ç”²é†‡åæ‡‰ç”Ÿæˆ", post: " (å†¬é’æ²¹)ã€‚", ans: "æ°´æ¥Šé…¸ç”²é…¯", opts: ["é˜¿æ–¯åŒ¹éˆ", "è‹¯ç”²é…¸", "è‹¯é…š"], exp: "ç¾§åŸºé…¯åŒ–ã€‚" },
            { type: 'text_choice', q: "åå¼è„‚è‚ªä¾†è‡ªæ¤ç‰©æ²¹çš„ï¼Ÿ", a: "éƒ¨åˆ†æ°«åŒ–", o: ["å®Œå…¨æ°«åŒ–", "æ°§åŒ–", "çš‚åŒ–", "é…¯åŒ–"], exp: "æ°«åŒ–éç¨‹å‰¯ç”¢ç‰©ã€‚" },
            { type: 'fill', pre: "é †ä¸çƒ¯äºŒé…¸åŠ ç†±è„«æ°´ç”Ÿæˆ", post: "ã€‚", ans: "é…¸é…", opts: ["é…¯", "é…®", "é†›"], exp: "é †ä¸çƒ¯äºŒé…¸é…ã€‚" }
        ]
    };

    // ================= 2. é‚è¼¯è™•ç† =================
    
    let selectedChapters = new Set();
    let currentList = [];
    let currentIndex = 0;
    let score = 0;
    let mistakes = [];
    
    // åˆå§‹åŒ–çµ±è¨ˆ
    let totalItems = 0;
    for (const cat in chemData) {
        totalItems += chemData[cat].length;
    }
    // æª¢æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œé¿å…å ±éŒ¯
    const totalEl = document.getElementById('total-db-items');
    if (totalEl) totalEl.innerText = totalItems;
    
    // åŸ·è¡Œé¸å–®ç¹ªè£½
    renderMenu();
    
    // è§£æ±ºç™½ç•«é¢å•é¡Œï¼šå¼·åˆ¶åŸ·è¡Œä¸€æ¬¡
    window.onload = function() {
        renderMenu();
    }

    function renderMenu() {
        const grid = document.getElementById('chapter-list');
        if (!grid) return;
        
        grid.innerHTML = "";
        
        Object.keys(chemData).forEach(cat => {
            const count = chemData[cat].length;
            const card = document.createElement('div');
            card.className = 'chapter-card';
            card.onclick = () => toggleSelection(card, cat);
            card.innerHTML = `
                <div class="ch-title">${cat}</div>
                <div class="ch-count">${count} é¡Œ</div>
            `;
            grid.appendChild(card);
        });
    }

    function toggleSelection(card, cat) {
        if (selectedChapters.has(cat)) {
            selectedChapters.delete(cat);
            card.classList.remove('selected');
        } else {
            selectedChapters.add(cat);
            card.classList.add('selected');
        }
        updateStats();
    }

    function updateStats() {
        document.getElementById('selected-count').innerText = selectedChapters.size;
        let currentTotal = 0;
        selectedChapters.forEach(cat => currentTotal += chemData[cat].length);
        document.getElementById('total-selected-items').innerText = currentTotal;

        const btnQuiz = document.getElementById('btn-start-quiz');
        if (btnQuiz) btnQuiz.disabled = (selectedChapters.size === 0);
    }

    function switchView(view) {
        document.querySelectorAll('.view-section').forEach(sec => sec.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        
        if (view === 'note') {
            document.getElementById('view-note').classList.add('active');
            document.querySelectorAll('.tab-btn')[0].classList.add('active');
        } else {
            document.getElementById('view-quiz').classList.add('active');
            document.querySelectorAll('.tab-btn')[1].classList.add('active');
            // åˆ‡æ›åˆ°æ¸¬é©—æ™‚ï¼Œé‡ç½®é¸å–®é¡¯ç¤ºï¼Œå¼·åˆ¶é‡æ–°ç¹ªè£½ä»¥é˜²è¬ä¸€
            document.getElementById('quiz-menu').style.display = 'block';
            document.getElementById('quiz-play').style.display = 'none';
            document.getElementById('quiz-result').style.display = 'none';
            renderMenu(); 
        }
        window.scrollTo(0, 0);
    }

    // ================= æ¸¬é©—é‚è¼¯ =================

    function prepareQuiz() {
        let total = 0;
        selectedChapters.forEach(cat => total += chemData[cat].length);
        
        document.getElementById('modal-total-items').innerText = total;
        const input = document.getElementById('quiz-num-input');
        input.max = total;
        input.value = Math.min(total, 20); 
        document.getElementById('quiz-settings-modal').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('quiz-settings-modal').style.display = 'none';
    }

    function confirmStartQuiz() {
        let allItems = [];
        selectedChapters.forEach(cat => {
            allItems = allItems.concat(chemData[cat]);
        });

        let count = parseInt(document.getElementById('quiz-num-input').value);
        if (isNaN(count) || count < 1) count = 5;
        if (count > allItems.length) count = allItems.length;

        shuffle(allItems);
        currentList = allItems.slice(0, count);

        closeModal();
        startQuizFlow();
    }

    function startQuizFlow() {
        currentIndex = 0;
        score = 0;
        mistakes = [];
        document.getElementById('quiz-menu').style.display = 'none';
        document.getElementById('quiz-play').style.display = 'block';
        loadQuestion();
    }

    function loadQuestion() {
        if (currentIndex >= currentList.length) {
            showResult();
            return;
        }

        const q = currentList[currentIndex];
        
        // UI æ›´æ–°
        document.getElementById('q-curr').innerText = currentIndex + 1;
        document.getElementById('q-total').innerText = currentList.length;
        document.getElementById('score').innerText = Math.round(score);
        document.getElementById('progress-fill').style.width = `${(currentIndex / currentList.length) * 100}%`;
        
        document.getElementById('feedback').style.display = 'none';
        
        const questionArea = document.getElementById('question-area');
        const answerArea = document.getElementById('answer-area');
        questionArea.innerHTML = '';
        answerArea.innerHTML = '';

        // === åˆ¤æ–·é¡Œå‹ä¸¦æ¸²æŸ“ ===
        if (q.type === 'fill') {
            // --- å¡«ç©ºé¡Œ ---
            const qCard = document.createElement('div');
            qCard.className = 'quiz-card';
            qCard.innerHTML = `
                <div style="font-size:1.3rem; line-height:2;">
                    ${q.pre} <div class="drop-slot" id="slot">?</div> ${q.post ? q.post : ''}
                </div>`;
            questionArea.appendChild(qCard);

            answerArea.className = 'drag-pool';
            const opts = [q.ans, ...q.opts].sort(() => 0.5 - Math.random());
            opts.forEach(opt => {
                const btn = document.createElement('div');
                btn.className = 'drag-item';
                btn.innerText = opt;
                btn.onclick = () => checkFillAnswer(opt, q);
                answerArea.appendChild(btn);
            });

        } else {
            // --- é¸æ“‡é¡Œ ---
            const qCard = document.createElement('div');
            qCard.className = 'quiz-card';
            if (q.type && q.type.includes('image')) {
                qCard.innerHTML = `${q.svg}<div class="q-text" style="font-size:1.2rem; margin-top:15px;">${q.q}</div>`;
            } else {
                qCard.innerHTML = `<div class="q-text">${q.q}</div>`;
            }
            questionArea.appendChild(qCard);

            answerArea.className = 'options-grid';
            const opts = [...q.o].sort(() => 0.5 - Math.random());
            opts.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'opt-btn';
                btn.innerText = opt;
                btn.onclick = () => checkChoiceAnswer(btn, opt, q);
                answerArea.appendChild(btn);
            });
        }
    }

    // --- æª¢æŸ¥ç­”æ¡ˆ ---

    function checkChoiceAnswer(btn, userAns, qData) {
        const btns = document.querySelectorAll('.opt-btn');
        btns.forEach(b => b.disabled = true);

        if (userAns === qData.a) {
            btn.classList.add('correct');
            score += 100 / currentList.length;
            showFeedback(true, qData.exp);
        } else {
            btn.classList.add('wrong');
            btns.forEach(b => { if(b.innerText === qData.a) b.classList.add('correct'); });
            showFeedback(false, `æ­£è§£æ˜¯ï¼š${qData.a}ã€‚<br>${qData.exp}`);
            mistakes.push(qData);
        }
    }

    function checkFillAnswer(userAns, qData) {
        const slot = document.getElementById('slot');
        if (slot.classList.contains('filled')) return; 

        slot.innerText = userAns;
        slot.classList.add('filled');
        
        const items = document.querySelectorAll('.drag-item');
        items.forEach(i => i.style.pointerEvents = 'none');

        if (userAns === qData.ans) {
            slot.style.borderBottomColor = 'var(--success)';
            slot.style.color = 'var(--success)';
            score += 100 / currentList.length;
            showFeedback(true, qData.exp);
        } else {
            slot.classList.add('error');
            showFeedback(false, `éŒ¯å›‰ï¼æ­£è§£æ˜¯ï¼š${qData.ans}ã€‚<br>${qData.exp}`);
            mistakes.push(qData);
        }
    }

    function showFeedback(isCorrect, text) {
        const fb = document.getElementById('feedback');
        const fbText = document.getElementById('feedback-text');
        fb.style.display = 'block';
        fbText.innerHTML = isCorrect ? `âœ… ç­”å°äº†ï¼<br><small>${text}</small>` : `âŒ ç­”éŒ¯äº†...<br><small>${text}</small>`;
    }

    function nextQuestion() {
        currentIndex++;
        loadQuestion();
    }

    // ================= çµæœèˆ‡å°èˆª =================

    function showResult() {
        document.getElementById('quiz-play').style.display = 'none';
        document.getElementById('quiz-result').style.display = 'block';
        
        document.getElementById('final-score').innerText = Math.round(score);
        const section = document.getElementById('mistake-section');
        const list = document.getElementById('mistake-list');
        list.innerHTML = "";

        if (mistakes.length > 0) {
            section.style.display = 'block';
            mistakes.forEach(m => {
                let displayQ = '', displayA = '';
                if (m.type === 'fill') {
                    displayQ = `${m.pre} ____ ${m.post ? m.post : ''}`; displayA = m.ans;
                } else {
                    displayQ = (m.type && m.type.includes('image')) ? 'çœ‹åœ–é¡Œ' : m.q; displayA = m.a;
                }

                list.innerHTML += `
                    <div class="chem-card-mini">
                        <div style="font-weight:bold; color:#333;">${displayQ}</div>
                        <div style="color:var(--success); margin-top:5px;">æ­£è§£ï¼š${displayA}</div>
                        <div style="font-size:0.9rem; color:#666; margin-top:5px;">${m.exp}</div>
                    </div>
                `;
            });
        } else {
            section.style.display = 'none';
        }
    }

    function retryQuiz() {
        shuffle(currentList); 
        startQuizFlow();
    }

    function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    // åˆå§‹åŒ–
    renderMenu();

</script>
</body>
</html>
